
# Cancun Hotel Booking API

#### Use case

People are now free to travel everywhere but because of the pandemic, a lot of hotels went
bankrupt. Some former famous travel places are left with only one hotel.
The very last hotel in Cancun needs a Booking API to manage their bookings.

The requirements are:
- API will be maintained by the hotelâ€™s IT department.
- As itâ€™s the very last hotel, the quality of service must be 99.99 to 100% => no downtime
- For the purpose of the test, we assume the hotel has only one room available
- To give a chance to everyone to book the room, the stay canâ€™t be longer than 3 days and canâ€™t be reserved more than 30 days in advance.
- All reservations start at least the next day of booking,
- To simplify the use case, a â€œDAYâ€™ in the hotel room starts from 00:00 to 23:59:59.
- Every end-user can check the room availability, place a reservation, cancel it or modify it.
- To simplify the API is insecure

#### Implementation

- This is a REST JAVA API built around [Spring ecosystem](https://spring.io/why-spring).
- It exposes few endpoints to manage bookings, details on each endpoint can be found further in this doc.
    - Swagger is implemented, so we have auto generated docs for the exposed endpoints. Also, it provides a nice UI for quick interaction at /swagger-ui.
  ```
    http://localhost:8080/swagger-ui/#/
  ```
- Current implementation can run both, [locally](ADD LINK) and in a [containerized environment](ADD LINK)
    - When running locally it connects to an H2 embedded database and stores data in memory
    - If running on docker it is configured to connect to a Postgres docker image running in a separate container
- Stay length and Booking period can be configured via Application.properties. If this rules changes in the future, no code changes are necessary. Examples of other usefully properties can be found [here](https://docs.spring.io/spring-boot/docs/2.5.2/reference/html/application-properties.html#application-properties.core)
```properties
# How many days in the future available for booking
booking.latest-date-in-days=30

# How long (in days) each booking can be
booking.max-period-in-days=3
```
- Spring profiles are used to have different sets of configurations/beans. Currently, apart from the default we have the 'docker' profile. The difference between them is that docker connects to Postgres while default connects to H2 DB.
    - [application.properties](ADD LINK) this file holds configurations that will be loaded by default. It is always loaded independently of profile, but clashing configurations will be overridden.
    - [application-docker.properties](ADD LINK) this file follow the pattern 'application-<profile>.properties, and will be loaded only specified profile is active. Currently, this file holds the Postgres related config.
    - More details about .properties files can be found at [spring docs](https://docs.spring.io/spring-boot/docs/2.5.2/reference/htmlsingle/#features.external-config)
    - There are few different ways to set active profiles, in this implementation it's being set via environment variable inside of container. More examples [here](https://docs.spring.io/spring-boot/docs/2.5.2/reference/htmlsingle/#features.profiles)
- This API is docker ready. It contains the following important files
   - [Dockerfile](ADD LINK) - Holds the instructions for creating the API image
   - [docker-compose.yaml](ADD LINK) - Holds configuration of containers environment. It builds our own api image (Based on the Dockerfile), and brings it up alongside with the Postgres
   - [.env](ADD LINK) - Contains the environment variables to be used by docker-compose. Here is where we are defining the spring profile.

- Booking IDs are generated by the API and follows the [UUID](https://techterms.com/definition/uuid) format

- This API was developed using [TDD](http://agiledata.org/essays/tdd.html), which leads to a very high code coverage during tests

#### Improvement Opportunities

- We have lots of Unit tests, but Integration and Performance Tests should be created in the future
- Internationalization of output messages is a nice to have, there are few different approaches to deal with this. Today all the output messages are located in the same static class to make it easier for future changes.
- Fine running on Logging strategies, consider some event logging to integrate with elastic search or splunk.

## API Reference

#### List all bookings

```http
  GET â€‹/apiâ€‹/booking
```

#### Find Booking by id

```http
  GET â€‹/apiâ€‹/bookingâ€‹/{id}
```

| Parameter | Type     | Description                       |
|:----------|:---------|:----------------------------------|
| `id`      | `string` | **Required**. Id of item to fetch |

#### List available dates

```http
  GET â€‹/apiâ€‹/bookingâ€‹/available
```

#### List booked dates

```http
  GET â€‹/apiâ€‹/bookingâ€‹/booked
```

#### Create new Booking record

```http
  POST â€‹/apiâ€‹/booking
```

| Parameter  | Type     | Description                 |
|:-----------|:---------|:----------------------------|
| `CheckIn`  | `String` | **Required**. CheckIn date  |
| `CheckOut` | `String` | **Required**. CheckOut date |

#### Update Booking

```http
  PUT â€‹/apiâ€‹/bookingâ€‹/{id}
```

| Parameter  | Type     | Description                        |
|:-----------|:---------|:-----------------------------------|
| `id`       | `string` | **Required**. Id of item to update |
| `checkIn`  | `string` | **Required**. New CheckIn date     |
| `checkOut` | `string` | **Required**. New CheckOut date    |

#### Cancel booking

```http
  DELETE â€‹/apiâ€‹/bookingâ€‹/{id}
```

| Parameter | Type     | Description                        |
|:----------|:---------|:-----------------------------------|
| `id`      | `string` | **Required**. Booking id to cancel |


## Tech Stack

- Java 11
- Spring Boot
- Spring Data
- H2 Embedded database (Local Running)
- Postgres database (Running on containers)
- Docker
- Docker compose
- Swagger2
- Gradle - (Gradle Wrapper is included in the source)


## Build and Run Locally

Clone the project

```bash
  git clone https://github.com/feliperuppel/cancun-hotel.git
```

Go to the project directory

```bash
  cd cancun-hotel
```

Build

```bash
  ./gradlew clean build
```

Start the server

```bash
  ./gradlew bootRun
```

## Build and Run on Docker

Clone the project

```bash
  git clone https://github.com/feliperuppel/cancun-hotel.git
```

Go to the project directory

```bash
  cd cancun-hotel
```

Build

```bash
  ./gradlew clean build
```

Start the server

```bash
  docker-compose up
```

## Running Tests

To run tests, run the following command

```bash
  ./gradlew test
```

## Swagger-ui

After the server is started you can access the following link and find a handy *"Try it out"* button to manually test the API.

```
http://localhost:8080/swagger-ui/
```
*Port 8080 is defaulted, but it can be changed via Application.properties* 

## ðŸš€ About Me
I am passionate about technology and love learning new things. I'm a Linux enthusiast with 10+
years of experience dealing with coding. Most of it was in Java.
You can find more about me at [feliperuppel.com](https://feliperuppel.com) or on my [LinkedIn profile](https://www.linkedin.com/in/feliperuppel/)

